# 5.2.4 ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Recoil, Jotai, Zustand ì‚´í´ë³´ê¸°

**recoilê³¼ jotai** </br>
: contextì™€ Provider, ê·¸ë¦¬ê³  í›…ì„ ê¸°ë°˜ìœ¼ë¡œ ê°€ëŠ¥í•œ ì‘ì€ ìƒíƒœë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬ , ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ ì „ì²´ì—ì„œ ê³µìœ í•˜ê³  ê´€ë¦¬í•˜ëŠ”ë° ì¤‘ì ì„ ë‘”ë‹¤.

```jsx
[recoil];
// Atom ì •ì˜
const countState = atom({
  key: 'countState',
  default: 0,
});
// RecoilRootë¥¼ í†µí•´ ì „ì²´ ì•±ì— ìƒíƒœ ê³µìœ 
function App() {
  return (
    <RecoilRoot>
      <Counter />
    </RecoilRoot>
  );
}

[jotai];
// Atom ì •ì˜
const countAtom = atom(0);
// Providerë¥¼ í†µí•´ ì „ì²´ ì•±ì— ìƒíƒœ ê³µìœ 
function App() {
  return (
    <Provider>
      <Counter />
    </Provider>
  );
}
```

**zustand** </br>
: ë¦¬ë•ìŠ¤ì™€ ë¹„ìŠ·í•˜ê²Œ í•˜ë‚˜ì˜ í° ìŠ¤í† ì–´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒíƒœ ê´€ë¦¬,

```jsx
[zustand];
// ìƒíƒœ ìŠ¤í† ì–´ ìƒì„±
const useStore = create((set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 })),
  decrement: () => set((state) => ({ count: state.count - 1 })),
}));

function App() {
  return <Counter />;
}
```

recoilê³¼ jotaiì™€ëŠ” ë‹¤ë¥´ê²Œ í•˜ë‚˜ì˜ í° ìŠ¤í† ì–´ëŠ” contextê°€ ì•„ë‹ˆë¼ ìŠ¤í† ì–´ê°€ ê°€ì§€ëŠ” í´ë¡œì €ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë˜ë©°,
ì´ ìŠ¤í† ì–´ì˜ ìƒíƒœê°€ ë³€ê²½ë˜ë©´ ì´ ìƒíƒœë¥¼ êµ¬ë…í•˜ê³  ìˆëŠ” ì»´í¬ë„ŒíŠ¸ì— ì „íŒŒí•´ ë¦¬ë Œë”ë§ì„ ì•Œë¦°ë‹¤.

> ### Q. ì–¸ì œ ê°ê°ì˜ ìƒíƒœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œìš”?

**í”„ë¡œì íŠ¸ ê·œëª¨ ë° ë³µì¡ì„±** : ì‘ì€ í”„ë¡œì íŠ¸ë‚˜ ê°„ë‹¨í•œ ìƒíƒœ ê´€ë¦¬ì—ëŠ” jotaië‚˜ zustandì™€ ê°™ì€ ê²½ëŸ‰ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì í•©

- ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ë‚˜ ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬ì—ëŠ” Recoilê³¼ ê°™ì€ ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”

[](https://velog.io/@juno7803/Recoil-Recoil-200-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0)[https://velog.io/@juno7803/Recoil-Recoil-200-í™œìš©í•˜ê¸°](https://velog.io/@juno7803/Recoil-Recoil-200-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0)

## 1. í˜ì´ìŠ¤ë¶ì´ ë§Œë“  ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Recoil

í›…ì˜ ê°œë…ìœ¼ë¡œ ìƒíƒœ ê´€ë¦¬ë¥¼ ì‹œì‘í•œ ìµœì´ˆì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬,</br>
ìµœì†Œ ìƒíƒœ ê°œë…ì¸ Atomì„ ì²˜ìŒ ë¦¬ì•¡íŠ¸ ìƒíƒœê³„ì— ì„ ë³´ì˜€ë‹¤.

Atom : atom ì€ ê¸°ì¡´ì˜ reduxì—ì„œ ì“°ì´ëŠ” **store** ì™€ ìœ ì‚¬í•œ ê°œë…ìœ¼ë¡œ, **ìƒíƒœì˜ ë‹¨ìœ„**ì…ë‹ˆë‹¤.

### 1) RecoilRoot

Recoilì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” RecoilRootë¥¼ ì•± ìµœìƒë‹¨ì— ì„ ì–¸

```jsx
export default function App() {
  return <RecoilRoot>{ë‚´ìš©}</RecoilRoot>;
}
```

> ### Q. RecoilRootë¥¼ ì™œ ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì„ ì–¸í•´ì•¼ í•˜ëŠ” ê±¸ê¹Œ?
>
> â‡’ Recoilì´ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ë¥¼ í†µí•´ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

: ì•„ë˜ ì½”ë“œë¥¼ ë³´ë©´ RecoilRootê°€ recoilì—ì„œ ìƒì„±ë˜ëŠ” ìƒíƒœê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•œë‹¤.

```jsx
function RecoilRoot(props: Props): React.Node {
  const {ğŸ’¬ override, ...propsExceptOverride} = props;

	//useStoreRef() í•¨ìˆ˜ëŠ” Recoilì—ì„œ ì‚¬ìš©ë˜ëŠ” ìŠ¤í† ì–´ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ë°˜í™˜
  const ğŸ’¬ ancestorStoreRef = useStoreRef();

  if (override === false && ancestorStoreRef.current !== defaultStore) {
  // RecoilRoot ì»´í¬ë„ŒíŠ¸ê°€ í˜„ì¬ì˜ ìŠ¤í† ì–´ê°€ ê¸°ë³¸ ìŠ¤í† ì–´ê°€ ì•„ë‹ˆê³ ,
  // ë™ì‹œì— override ì†ì„±ì´ ëª…ì‹œì ìœ¼ë¡œ falseë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´,
  // RecoilRoot ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ë¥¸ ìŠ¤í† ì–´ë¥¼ ì°¸ì¡°í•˜ê³  ìˆìœ¼ë©°, ì¤‘ì²©ë˜ì§€ ì•Šì•˜ìŒì„ ì˜ë¯¸

  // ê·¸ëŒ€ë¡œ ìì‹ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤.
    return props.children;
  }

// ìƒˆë¡œìš´ ìŠ¤í† ì–´ ìƒì„±
  return <RecoilRoot_INTERNAL {...propsExceptOverride} />;
}

```

ğŸ’¬ ancestorStoreRef : Recoil ìƒíƒœì— ì ‘ê·¼í•˜ê³  ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•œ ìˆ˜ë‹¨

ğŸ’¬ override : í”„ë¡œí¼í‹°ëŠ” Recoil ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ì‚¬ìš©ì ì •ì˜ í”„ë¡œí¼í‹°</br>
â‡’ RecoilRoot ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ì„ ì œì–´í•˜ê¸° ìœ„í•œ ê²ƒ

âœ… useStoreRefë¡œ ancestorStoreRefì˜ ì¡´ì¬ë¥¼ í™•ì¸í•œë‹¤.

â‡’ ì´ëŠ” Recoilì—ì„œ ìƒì„±ë˜ëŠ” atomê³¼ ê°™ì€ ìƒíƒœê°’ì„ ì €ì¥í•˜ëŠ” ìŠ¤í† ì–´ë¥¼ ì˜ë¯¸,

```
 useStoreRefê°€ ê°€ë¦¬í‚¤ëŠ” ê²ƒì€ ğŸ’¬AppContextê°€ ê°€ì§€ê³  ìˆëŠ” ìŠ¤í† ì–´ë‹¤.
```

ğŸ’¬ AppContext : ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœì™€ ì„¤ì •ì„ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì»¨í…ìŠ¤íŠ¸</br>
`useStoreRef()`í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” ì°¸ì¡°ëŠ” ì´ëŸ¬í•œ `AppContext` ì—ì„œ ê´€ë¦¬í•˜ëŠ” Recoil ìŠ¤í† ì–´ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ë‚˜íƒ€ë‚´ë©° ë”°ë¼ì„œ `ancestorStoreRef`ê°€ ê°€ë¦¬í‚¤ëŠ” ê²ƒì€ ì‹¤ì œë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Recoil ìŠ¤í† ì–´ì´ë‹¤.

```jsx
const AppContext = React.createContext < StoreRef > { current: defaultStore };
const useStoreRef = (): StoreRef => useContext(AppContext);
```

ìŠ¤í† ì–´ì˜ ê¸°ë³¸ ê°’ì„ ì˜ë¯¸í•˜ëŠ” defaultStoreëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```jsx
function notInAContext() {
  throw err('This component must be used inside a <RecoilRoot> component.');
}

const defaultStore: Store = Object.freeze({
	// ìŠ¤í† ì–´ì˜ ê³ ìœ  ì‹ë³„ì
  storeID: getNextStoreID(),
  // ë‚˜ë¨¸ì§€ í•¨ìˆ˜ : ìŠ¤í† ì–´ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ì¡°ì‘í•˜ê¸° ìœ„í•œ í•¨ìˆ˜
  getState: notInAContext,
  ğŸ’¡replaceState: notInAContext,
  getGraph: notInAContext,
  subscribeToTransactions: notInAContext,
  addTransactionMetadata: notInAContext,
  //notInAContext : ì»¨í…ìŠ¤íŠ¸ì— ì†í•´ ìˆì§€ ì•Šì€ ìƒíƒœì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
});
```

âœ… getNextStoreId : ìŠ¤í† ì–´ì˜ ë‹¤ìŒ ì•„ì´ë”” ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜

âœ… getState : ìŠ¤í† ì–´ì˜ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜

âœ… replaceState : ê°’ì„ ìˆ˜ì •í•˜ëŠ” í•¨ìˆ˜

í•´ë‹¹ ìŠ¤í† ì–´ ì•„ì´ë””ë¥¼ ì œì™¸í•˜ê³ ëŠ” ëª¨ë‘ ì—ëŸ¬ë¡œ ì²˜ë¦¬ë¼ ìˆìœ¼ë©°, ì´ëŠ” recoilRootë¡œ ê°ì‹¸ì§€ ì•Šì€ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ìŠ¤í† ì–´ì— ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒ

+ğŸ’¡ í•œê°€ì§€ í¥ë¯¸ë¡œìš´ ê²ƒì€ replaceStateì— ëŒ€í•œ êµ¬í˜„ì´ë‹¤.

**[replaceState]**

```jsx
const replaceState = (replacer: (TreeState) => TreeState) => {
  startNextTreeIfNeeded(storeRef.current);
  // Use replacer to get the next state:
  const nextTree = nullthrows(storeStateRef.current.nextTree);
  let replaced;
  try {
    stateReplacerIsBeingExecuted = true;
    replaced = replacer(nextTree);
  } finally {
    stateReplacerIsBeingExecuted = false;
  }
  if (replaced === nextTree) {
    return;
  }

  if (__DEV__) {
    if (typeof window !== 'undefined') {
      window.$recoilDebugStates.push(replaced); // TODO this shouldn't happen here because it's not batched
    }
  }

  // Save changes to nextTree and schedule a React update:
  storeStateRef.current.nextTree = replaced;
  if (reactMode().early) {
    notifyComponents(storeRef.current, storeStateRef.current, replaced);
  }
  nullthrows(notifyBatcherOfChange.current)();
};
```

ìƒíƒœê°€ ë³€í•  ë•Œ ì´ ë³€ê²½ëœ ìƒíƒœë¥¼ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë¡œ ì „íŒŒí•´ ì»´í¬ë„ŒíŠ¸ì— ë¦¬ë Œë”ë§ì„ ì¼ìœ¼í‚¤ëŠ” notifyComponentsê°€ ìˆë‹¤.

**[notifyComponents]**

```jsx
function notifyComponents(store: Store, storeState: StoreState, treeState: TreeState): void {
  const dependentNodes = getDownstreamNodes(store, treeState, treeState.dirtyAtoms);
  for (const key of dependentNodes) {
    const comps = storeState.nodeToComponentSubscriptions.get(key);
    if (comps) {
      for (const [_subID, [_debugName, callback]] of comps) {
        callback(treeState);
      }
    }
  }
}
```

notifyComponentsëŠ” store, ê·¸ë¦¬ê³  ìƒíƒœë¥¼ ì „íŒŒí•  storeStateë¥¼ ì¸ìˆ˜ë¥¼ ë°›ì•„ ì´ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” í•˜ìœ„ ì˜ì¡´ì„±ì„ ëª¨ë‘ ê²€ìƒ‰í•œ ë‹¤ìŒ, ì—¬ê¸°ì— ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì„ ëª¨ë‘ í™•ì¸í•´ ì½œë°±ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

ê°’ì´ ë³€ê²½ëì„ ë•Œ ì½œë°±ì„ ì‹¤í–‰í•´ ìƒíƒœ ë³€í™”ë¥¼ ì•Œë¦°ë‹¤ â‡’ ë°”ë‹ë¼ ìŠ¤í† ì–´ì™€ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šë‹¤.

[RecoilRoot ìš”ì•½]

- Recoilì˜ ìƒíƒœê°’ì€ RecoilRootë¡œ ìƒì„±ëœ Contextì˜ ìŠ¤í† ì–´ì— ì €ì¥ëœë‹¤.
- ìŠ¤í† ì–´ì˜ ìƒíƒœê°’ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë“¤ì´ ìˆìœ¼ë©° í•´ë‹¹ í•¨ìˆ˜ë“¤ë¡œ ìƒíƒœê°’ì— ì ‘ê·¼ & ë³€ê²½ì„ ìˆ˜í–‰í•œë‹¤.
- ê°’ì˜ ë³€ê²½ì´ ì¼ì–´ë‚˜ë©´ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ê²Œ ëª¨ë‘ ì•Œë¦°ë‹¤.

### 2) atom

Atom : </br> Recoilì—ì„œ ìƒíƒœë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ë‹¨ìœ„
atomì´ ì—…ë°ì´íŠ¸ ë˜ë©´, í•´ë‹¹ atomì„ êµ¬ë…í•˜ê³  ìˆë˜ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë“¤ì˜ stateê°€ ìƒˆë¡œìš´ ê°’ìœ¼ë¡œ ë¦¬ë Œë” ë©ë‹ˆë‹¤.

unique í•œ idì¸ keyë¡œ êµ¬ë¶„ë˜ëŠ” ê° atomì€, ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ atomì„ êµ¬ë…í•˜ê³  ìˆë‹¤ë©´ ê·¸ ì»´í¬ë„ŒíŠ¸ë“¤ë„ ë˜‘ê°™ì€ ìƒíƒœë¥¼ ê³µìœ í•©ë‹ˆë‹¤(ìƒíƒœê°€ ë°”ë€Œë©´ ë°”ë€ ê°’ìœ¼ë¡œ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ë“¤ì´ re-renderë©ë‹ˆë‹¤)

```jsx
type Statement = {
	name : string
    amout : number
}

const InitialStatements : Array<Statement> = [
	{name : 'ê³¼ì' , amount : -500},
    {name : 'ìš©ëˆ' , amount : 10000},
    {name : 'ê¹Œê¹Œ' , amount : -5000},
]

//Atom ì„ ì–¸
const statementsAtom = atom<Array<Statement>>({
	key : 'statements',
    default : InitialStatements,
})

```

atom:

- key ê°’ì„ í•„ìˆ˜ë¡œ ê°€ì§€ë©°, ì´ ê²ƒì€ ë‹¤ë¥¸ atomê³¼ êµ¬ë³„í•˜ëŠ” ì‹ë³„ìê°€ ë˜ëŠ” í•„ìˆ˜ ê°’.
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ì—ì„œ ìœ ì¼í•œ ê°’ì´ì–´ì•¼í•˜ê¸°ì— atomê³¼ selectorë¥¼ ë§Œë“¤ ë•Œ ë°˜ë“œì‹œ ì£¼ì˜ë¥¼ ê¸°ìš¸ì—¬ì•¼ í•œë‹¤.
- defaultëŠ” atomì˜ ì´ˆê¸°ê°’

atomì˜ ê°’ì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì½ì–´ì˜¤ê³  ì´ ê°’ì˜ ë³€í™”ì— ë”°ë¼ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§í•˜ë ¤ë©´ ë‹¤ìŒ ë‘ê°€ì§€ í›…[userRecoilValue, userRecoilState]ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

### 3) userRecoilValue

atomì˜ ê°’ì„ ì½ì–´ì˜¤ëŠ” í›…

```jsx
function Statements(){
	const statements = useRecoilValue(statementsAtom)
    return (
    	<>{something...}</>
    )
}

```

[userRecoilValue í›…ì˜ êµ¬í˜„]

- userRecoilValue

  ```jsx
  function useRecoilValue<T>(recoilValue: RecoilValue<T>): T {
    // Recoil ê°’ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬ __DEV__ê°€ true ì¼ë•Œë§Œ,
    if (__DEV__) {
      validateRecoilValue(recoilValue, 'useRecoilValue');
    }
    // Recoil ìŠ¤í† ì–´ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ê°€ì ¸ì˜¤ê¸°
    const storeRef = useStoreRef();
    // Recoil ê°’ì˜ ìƒíƒœë¥¼ ë¡œë“œ
    const loadable = useRecoilValueLoadable(recoilValue);
    // ë¡œë“œí•œ ìƒíƒœ ë°˜í™˜
    return handleLoadable(loadable, recoilValue, storeRef);
  }
  ```

- userRecoilValueLoadable

  ```jsx
  function useRecoilValueLoadable_LEGACY<T>(recoilValue: RecoilValue<T>): Loadable<T> {
    //useStoreRef í›…ì„ ì‚¬ìš©í•˜ì—¬ Recoil ìŠ¤í† ì–´ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ê°€ì ¸ì˜¤ê³ ,
    // ì»´í¬ë„ŒíŠ¸ì˜ ë Œë”ë§ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆëŠ” forceUpdate í•¨ìˆ˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.
    const storeRef = useStoreRef();
    const [, forceUpdate] = useState([]);
    const componentName = useComponentName();
    //  í˜„ì¬ Recoil ìƒíƒœì—ì„œ Recoil ê°’ì˜ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ì„ êµ¬í˜„
    const getLoadable = useCallback(() => {
      if (__DEV__) {
        recoilComponentGetRecoilValueCount_FOR_TESTING.current++;
      }
      const store = storeRef.current;
      const storeState = store.getState();
      const treeState = reactMode().early
        ? storeState.nextTree ?? storeState.currentTree
        : storeState.currentTree;
      return getRecoilValueAsLoadable(store, recoilValue, treeState);
    }, [storeRef, recoilValue]);

    const loadable = getLoadable();
    // ì´ì „ ìƒíƒœì™€ í˜„ì¬ ìƒíƒœë¥¼ ë¹„êµí•˜ì—¬ ë³€ê²½ëœ ìƒíƒœë¥¼ ê°ì§€
    const prevLoadableRef = useRef(loadable);
    // useEffect í›…ì„ ì‚¬ìš©í•˜ì—¬ Recoil ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤
    // ì»´í¬ë„ŒíŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ë Œë”ë§ì„ ê°•ì œë¡œ ì¼ìœ¼í‚µë‹ˆë‹¤.
    useEffect(() => {
      prevLoadableRef.current = loadable;
    });

    useEffect(() => {
      const store = storeRef.current;
      const storeState = store.getState();
      const subscription = subscribeToRecoilValue(
        store,
        recoilValue,
        (_state) => {
          if (!gkx('recoil_suppress_rerender_in_callback')) {
            return forceUpdate([]);
          }
          const newLoadable = getLoadable();
          if (!prevLoadableRef.current?.is(newLoadable)) {
            forceUpdate(newLoadable);
          }
          prevLoadableRef.current = newLoadable;
        },
        componentName
      );

      if (storeState.nextTree) {
        store.getState().queuedComponentCallbacks_DEPRECATED.push(() => {
          prevLoadableRef.current = null;
          forceUpdate([]);
        });
      } else {
        if (!gkx('recoil_suppress_rerender_in_callback')) {
          return forceUpdate([]);
        }
        const newLoadable = getLoadable();
        if (!prevLoadableRef.current?.is(newLoadable)) {
          forceUpdate(newLoadable);
        }
        prevLoadableRef.current = newLoadable;
      }

      return subscription.release;
    }, [componentName, getLoadable, recoilValue, storeRef]);

    return loadable;
  }
  ```

ìœ„ì˜ ì½”ë“œë¥¼ ì§ê´€ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆê²Œ useRecoilValueLoadable_LEGACYë¥¼ ê°€ì ¸ì™”ë‹¤.

getLoadable : í˜„ì¬ Recoilì´ ê°€ì§€ê³  ìˆëŠ” ìƒíƒœê°’ì„ ê°€ì§€ê³  ìˆëŠ” í´ë˜ìŠ¤ì¸ lodableì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜</br>
â‡’ ì´ ê°’ì„ ì´ì „ê°’ê³¼ ë¹„êµí•´ ë Œë”ë§ì´ í•„ìš”í•œì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ë Œë”ë§ì„ ì¼ìœ¼í‚¤ì§€ ì•Šìœ¼ë©´ì„œ ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” refì— ë§¤ë²ˆ ì €ì¥í•œë‹¤.

ê·¸ë¦¬ê³  useEffectë¥¼ í†µí•´ recoilValueê°€ ë³€ê²½ëì„ ë•Œ, forceUpdateë¥¼ í˜¸ì¶œí•´ ë Œë”ë§ì„ ê°•ì œë¡œ ì¼ìœ¼í‚¨ë‹¤.

â‡’ useState ê°’ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•¨ì´ ì•„ë‹Œ ë§ ê·¸ëŒ€ë¡œ ë Œë”ë§ë§Œ ë°œìƒ ì‹œí‚¤ê¸° ìœ„í•´

ì´ëŸ¬í•œ ê³¼ì •ì„ í†µí•´ Recoilì—ì„œëŠ” ìƒíƒœì˜ ë³€í™”ë¥¼ ê°ì§€í•˜ê³ , ë³€ê²½ëœ ìƒíƒœë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì—ê²Œ ì ì ˆíˆ ë°˜ì˜í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

### 4) userRecoilState

useRecoilValueê°€ ë‹¨ìˆœ atomì˜ ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ê°’ì´ë¼ë©´ userRecoilState í›…ì€ useStateì²˜ëŸ¼ ê°’ì„ ê°€ì ¸ì˜¤ê³  ìˆ˜ì •í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í›…ì´ë‹¤.

```jsx
function useRecoilState<T>(recoilState: RecoilState<T>): [T, SetterOrUpdater<T>] {
  if (__DEV__) {
    validateRecoilValue(recoilState, 'useRecoilState');
  }
  return [useRecoilValue(recoilState), useSetRecoilState(recoilState)];
}
```

useRecoilState í›…ì€ useStateì™€ ë§¤ìš° ìœ ì‚¬í•œ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆë‹¤. ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œëŠ” useRecoilValueë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©° useSetRecoilStateí›…ìœ¼ë¡œ ìƒíƒœë¥¼ ë³€ê²½í•˜ê³  ìˆë‹¤.

**[useSetRecoilState]**

```jsx
function useSetRecoilState<T>(recoilState: RecoilState<T>): SetterOrUpdater<T> {
  if (__DEV__) {
    validateRecoilValue(recoilState, 'useSetRecoilState');
  }
  const storeRef = useStoreRef();
  return useCallback(
    (newValueOrUpdater: ((T) => T | DefaultValue) | T | DefaultValue) => {
      setRecoilValue(storeRef.current, recoilState, newValueOrUpdater);
    },
    [storeRef, recoilState]
  );
}
```

ì´ í›…ì€ ë‚´ë¶€ì—ì„œ ë¨¼ì € ìŠ¤í† ì–´ë¥¼ ê°€ì ¸ì˜¨ ë‹¤ìŒì— setRecoilValueë¥¼ í˜¸ì¶œí•´ ê°’ì„ ì—…ë°ì´íŠ¸í•˜ê³  ìˆë‹¤.

**[setRecoilValue ì±… ì°¸ê³  5.9]**

setRecoilValueë‚´ë¶€ì—ëŠ” queueOrPerformStateUpdateí•¨ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ í•˜ê³  ìˆë‹¤.

**[ìš”ì•½]**

- ìµœìƒë‹¨ì— RecoilRootë¥¼ ì„ ì–¸í•´ í•˜ë‚˜ì˜ ìŠ¤í† ì–´ ìƒì„±
- atomì´ë¼ëŠ” ìƒíƒœ ë‹¨ìœ„ë¥¼ <RecoilRoot/>ì—ì„œ ë§Œë“  ìŠ¤í† ì–´ì— ë“±ë¡
- atomì€ recoilì—ì„œ ê°€ì¥ ì‘ì€ ìƒíƒœ ë‹¨ìœ„ì´ë©°, ê° ê°’ì€ ê³ ìœ í•œ ê°’ì¸ keyë¥¼ ë°”íƒ•ìœ¼ë¡œ êµ¬ë³„
- ì»´í¬ë„ŒíŠ¸ëŠ” recoilì—ì„œ ì œê³µí•˜ëŠ” í›…ì„ í†µí•´ atomì˜ ìƒíƒœ ë³€í™”ë¥¼ êµ¬ë…
- ê°’ì´ ë³€ê²½ë˜ë©´ forceUpdateê°™ì€ ê¸°ë²•ì„ í†µí•´ ë¦¬ë Œë”ë§ì„ ì‹¤í–‰í•´ ìµœì‹  atomê°’ì„ ê°€ì ¸ì˜¨ë‹¤.

## Recoilì„ ì‚¬ìš©í•´ë³´ì

[https://codesandbox.io/p/devbox/frosty-hofstadter-6l262w?file=%2Fsrc%2Fmain.tsx%3A11%2C1](https://codesandbox.io/p/devbox/frosty-hofstadter-6l262w?file=%2Fsrc%2Fmain.tsx%3A11%2C1)

```jsx
import React from 'react';
import { RecoilRoot, atom, selector, useRecoilState, useRecoilValue } from 'recoil';

//Recoilì—ì„œ ìƒíƒœë¥¼ ì •ì˜í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.
//atom í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ ì„ ì–¸í•˜ê³ ,
//ì´ë¥¼ counterStateë¼ëŠ” ê³ ìœ í•œ í‚¤ë¡œ ì‹ë³„í•©ë‹ˆë‹¤.
//ì´ˆê¸°ê°’ìœ¼ë¡œ 0ì„ ì„¤ì •

const counterState = atom({
  key: 'counterState',
  default: 0,
});

function Counter() {
  // useRecoilState í›…ì„ ì‚¬ìš©í•˜ì—¬ counterStateì˜ ê°’ì„ ê°€ì ¸ì˜¤ê³  ì„¤ì •
  const [, setCount] = useRecoilState(counterState);

  function handleButtonClick() {
    setCount((count: any) => count + 1);
  }

  return (
    <>
      <button onClick={handleButtonClick}>+</button>
    </>
  );
}
// SelectorëŠ” í•˜ë‚˜ ì´ìƒì˜ Atom ê°’ì„ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ê°’ì„ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜
// selector í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ Selectorë¥¼ ì„ ì–¸í•˜ê³ ,
// ì´ë¥¼ isBiggerThan10ì´ë¼ëŠ” ê³ ìœ í•œ í‚¤ë¡œ ì‹ë³„í•©ë‹ˆë‹¤.
// ì´ SelectorëŠ” counterState Atomì˜ ê°’ì´ 10ë³´ë‹¤ í°ì§€ ì—¬ë¶€ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
const isBiggerThan10 = selector({
  key: 'above10State',
  get: ({ get }) => {
    return get(counterState) >= 10;
  },
});

function Count() {
  // ìƒíƒœ ê°’ê³¼ Selectorì˜ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
  const count = useRecoilValue(counterState);
  const biggerThan10 = useRecoilValue(isBiggerThan10);

  return (
    <>
      <h3>{count}</h3>
      <p>count is bigger than 10 : {JSON.stringify(biggerThan10)}</p>
    </>
  );
}

const MyComponent = () => {
  return (
    <RecoilRoot>
      <Counter></Counter>
      <Count></Count>
    </RecoilRoot>
  );
};

export default MyComponent;
```

selectorëŠ” í•œ ê°œ ì´ìƒì˜ atomê°’ì„ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ê°’ì„ ì¡°ë¦½í•˜ëŠ” API

â‡’ useStoreSelectorì™€ ìœ ì‚¬í•œ ì—­í• ì„ ìˆ˜í–‰í•œë‹¤.

ì´ ì™¸ì—ë„ atomì— ë¹„ë™ê¸° ì‘ì—…ë„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

- useRecoilStateLoadable, waitForAll, waitForAny, waitForAllSetteldì™€ ê°™ì´ ê°•ë ¥í•œ ë¹„ë™ê¸° ì‘ì—…ì„ ì§€ì›í•˜ê¸° ìœ„í•œ APIë„ ì§€ì›
- ë¦¬ë•ìŠ¤ì™€ ë‹¬ë¦¬ ì¶”ê°€ì ì¸ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šë”ë¼ë„ ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜ì›”í•˜ê²Œ ì²˜ë¦¬ í•  ìˆ˜ ìˆë‹¤.

## 2. Recoilì—ì„œ ì˜ê°ì„ ë°›ì€, ê·¸ëŸ¬ë‚˜ ì¡°ê¸ˆ ë” ìœ ì—°í•œ Jotai

- recoilì˜ atom ëª¨ë¸ì— ì˜ê°ì„ ë°›ì•„ ë§Œë“¤ì–´ì§„ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
- ìƒí–¥ì‹ ì ‘ê·¼ë²•ì„ ì·¨í•˜ì§€ë§Œ, ì´ëŠ” ë¦¬ë•ìŠ¤ì™€ ê°™ì´ í•˜ë‚˜ì˜ í° ìƒíƒœë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë‚´ë ¤ì£¼ëŠ” ë°©ì‹ì´ ì•„ë‹Œ, ì‘ì€ ë‹¨ìœ„ì˜ ìƒíƒœë¥¼ ìœ„ë¡œ ì „íŒŒí•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ì·¨í•˜ê³  ìˆìŒì„ ì˜ë¯¸
- ì„¤ê³„ ì´ìœ  : contextì˜ ë¬¸ì œì ì¸ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚œë‹¤ëŠ” ë¬¸ì œë¥¼ í•´ê²° â‡’ ë©”ëª¨ì´ì œì´ì…˜ì´ë‚˜ ìµœì í™”ë¥¼ ê±°ì¹˜ì§€ ì•Šì•„ë„ ë¦¬ë Œë”ë§ì´ ë°œìƒë˜ì§€ ì•ŠëŠ”ë‹¤.

## 1) atom

```jsx
const couterAtom = atom(0);
```

- recoilê³¼ëŠ” ë‹¤ë¥´ê²Œ atom í•˜ë‚˜ë§Œìœ¼ë¡œë„ ìƒíƒœë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. </br> â‡’ ë˜ ì´ì— íŒŒìƒëœ ìƒíƒœë¥¼ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.
- recoilê³¼ì˜ ì°¨ì´ â‡’ atomì´ ìµœì†Œí•œì˜ ìƒíƒœ ë‹¨ìœ„ë¼ëŠ” ê²ƒê¹Œì§€ëŠ” ë™ì¼í•˜ì§€ë§Œ atom í•˜ë‚˜ë¡œ íŒŒìƒëœ ìƒíƒœê¹Œì§€ ë§Œë“¤ ìˆ˜ ìˆë‹¤

**ë¹„êµ ì˜ˆì‹œ** </br>
[recoil]

```jsx
import { RecoilRoot, atom, selector, useRecoilState, useRecoilValue } from 'recoil';

// Atom ì •ì˜
const counterState = atom({
  key: 'counterState',
  default: 0,
});

// Selector ì •ì˜
const doubleCounterState = selector({
  key: 'doubleCounterState',
  get: ({ get }) => {
    const counter = get(counterState);
    return counter * 2;
  },
});

function App() {
  return (
    <RecoilRoot>
      <Counter />
      <DoubleCounter />
    </RecoilRoot>
  );
}

function Counter() {
  const [count, setCount] = useRecoilState(counterState);

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}

function DoubleCounter() {
  const doubleCount = useRecoilValue(doubleCounterState);

  return <p>Double Count: {doubleCount}</p>;
}
```

- ìœ„ì˜ Recoil ì½”ë“œì—ì„œëŠ” `counterState`ë¼ëŠ” atomì„ ì •ì˜í•˜ê³ , ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ `Counter` ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³ , `doubleCounterState`ë¼ëŠ” selectorë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ ë‘ ë°°ë¡œ ê³„ì‚°í•˜ëŠ” íŒŒìƒëœ ìƒíƒœë¥¼ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤. ì´ë•Œ `doubleCounterState`ëŠ” `counterState`ì— ì˜ì¡´í•˜ê³  ìˆìŠµë‹ˆë‹¤.

**[jotai]**

```jsx
import { Provider, atom, useAtom } from 'jotai';

// Atom ì •ì˜
const counterAtom = atom(0);

function App() {
  return (
    <Provider>
      <Counter />
      <DoubleCounter />
    </Provider>
  );
}

function Counter() {
  const [count, setCount] = useAtom(counterAtom);

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}

function DoubleCounter() {
  const [count] = useAtom(counterAtom);
  const doubleCount = count * 2;

  return <p>Double Count: {doubleCount}</p>;
}
```

- Jotaiì—ì„œëŠ” `atom` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ìœ„ì˜ ì˜ˆì‹œì—ì„œëŠ” `counterAtom`ì´ë¼ëŠ” atomì„ ì •ì˜í•˜ê³ , ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ `Counter` ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  `DoubleCounter` ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” `counterAtom`ì„ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ ë‘ ë°°ë¡œ ê³„ì‚°ëœ ìƒíƒœë¥¼ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤. ë‘ ì»´í¬ë„ŒíŠ¸ëŠ” ëª¨ë‘ `counterAtom`ì„ ì‚¬ìš©í•˜ì—¬ ê°ê°ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  í‘œì‹œí•©ë‹ˆë‹¤.

ìœ„ì˜ ì˜ˆì‹œ ì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, Recoilì—ì„œëŠ” íŒŒìƒëœ ìƒíƒœë¥¼ selectorë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜í•˜ê³  ìˆì§€ë§Œ, Jotaiì—ì„œëŠ” atomì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ íŒŒìƒëœ ìƒíƒœë¥¼ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤.

> ### Q. atom ì•ˆì—ëŠ” ì–´ë–¤ ê²ƒì´ ë‹´ê¸¸ê¹Œ?

```jsx
const counterAtom = atom(0);

console.log(counterAtom);
//,...
//{
//	init : 0,
//    read : (get) => get(config),
//    write : (get,set,update) =>
//    	set(config, typeof update === 'function' ? update(get(config)) : update)
//}
```

> ### Q. atomì€ ì–´ë–¤ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆì„ê¹Œ?

```jsx
export function atom<Value, Update, Result extends void | Promise<void>>(
  read: Value | Read<Value>,
  write?: Write<Update, Result>
) {
  const key = `atom${++keyCount}`
  const config = {
    toString: () => key,
  } as WritableAtom<Value, Update, Result> & { init?: Value }
  if (typeof read === 'function') {
    config.read = read as Read<Value>
  } else {
    config.init = read
    config.read = (get) => get(config)
    config.write = (get, set, update) =>
      set(config, typeof update === 'function' ? update(get(config)) : update)
  }
  if (write) {
    config.write = write
  }
  return config

```

ìš°ì„  atomì´ë¼ëŠ” ì›ë¦¬ëŠ” recoilì—ì„œ ë°›ì•˜ì§€ë§Œ êµ¬í˜„ ìì²´ì—ëŠ” ì°¨ì´ê°€ ìˆë‹¤.

recoil : atomì„ ìƒì„±í•  ë•Œë§ˆë‹¤ ê³ ìœ í•œ keyë¥¼ í•„ìš”</br>
jotai : key í•„ìš” ì—†ìŒ

- atom ë‚´ë¶€ì—ëŠ” keyë¼ëŠ” ë³€ìˆ˜ê°€ ì¡´ì¬í•˜ì§€ë§Œ ì™¸ë¶€ì—ì„œ ë°›ëŠ” ê°’ì´ ì•„ë‹Œ toString()ì„ ìœ„í•œ ìš©ë„
  â‡’ ì´ë ‡ê²Œ í•˜ë©´ atomì„ ì‰½ê²Œ ì‹ë³„í•  ìˆ˜ ìˆë‹¤.
- ê·¸ë¦¬ê³  configë¼ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. </br>int : ì´ˆê¸°ê°’ </br>read : ê°’ ê°€ì ¸ì˜¤ê¸° </br>write : ê°’ ì„¤ì •

> ### â‡’ ì¦‰, jotaiì—ì„œì˜ atomì— ë”°ë¡œ ìƒíƒœë¥¼ ì €ì¥í•˜ê³  ìˆì§€ ì•Šë‹¤.

: ì´ í•´ë‹µì€ useAtomValueì— ìˆë‹¤.

> ### Q. **Jotaiì—ì„œ atomì˜ keyê°€ ì™¸ë¶€ì—ì„œ ì œê³µë˜ì§€ ì•Šê³  toString() ë©”ì„œë“œë¥¼ í†µí•´ ì‚¬ìš©ë˜ëŠ” ì´ìœ ê°€ ë¬´ì—‡ì¸ê°€ìš”?**

1.  **ê°„í¸í•¨ê³¼ ìœ ì—°ì„±**:

- ì‚¬ìš©ìê°€ ê³ ìœ í•œ í‚¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê´€ë¦¬í•  í•„ìš”X
- ëŒ€ì‹ , JotaiëŠ” ë‚´ë¶€ì—ì„œ ìë™ìœ¼ë¡œ ìœ ë‹ˆí¬í•œ í‚¤ë¥¼ ìƒì„±í•˜ê³  atomì„ ê´€ë¦¬

2.  **ì¶©ëŒ ë°©ì§€**:

- ì™¸ë¶€ì—ì„œ í‚¤ë¥¼ ì œê³µí•˜ëŠ” ê²½ìš°, ì‚¬ìš©ìê°€ ì¤‘ë³µëœ í‚¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê´€ë¦¬í•˜ëŠ” ê²½ìš° ì¶©ëŒì´ ë°œìƒí•  ìˆ˜ ìˆìŒ í•˜ì§€ë§Œ JotaiëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ìœ ë‹ˆí¬í•œ í‚¤ë¥¼ ìƒì„±í•˜ë¯€ë¡œ ì´ëŸ¬í•œ ì¶©ëŒì„ ë°©ì§€ê°€ëŠ¥

3.  **ë””ë²„ê¹…**:

- toString() ë©”ì„œë“œë¥¼ í†µí•´ atomì„ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ë©°, ë””ë²„ê¹… ëª©ì ìœ¼ë¡œ ìœ ìš© atomì„ ì½˜ì†”ì— ì¶œë ¥í•˜ê±°ë‚˜ ë¡œê¹…í•  ë•Œ ìœ ë‹ˆí¬í•œ ì‹ë³„ìë¥¼ ì œê³µí•˜ì—¬ atomì„ ì‰½ê²Œ ì‹ë³„í•˜ê³  ë””ë²„ê¹…í•  ìˆ˜ ìˆë‹¤.

## 2) useAtomValue : atomì˜ ê°’ì„ ì½ì–´ì˜¤ëŠ” ì—­í• 

```jsx
export function useAtomValue<Value>(
  atom: Atom<Value>, // useAtomValue í•¨ìˆ˜ëŠ” atomì´ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ë°›ìŠµë‹ˆë‹¤. atomì€ Jotaiì˜ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ì…ë‹ˆë‹¤.
  scope?: Scope // ì„ íƒì ìœ¼ë¡œ scope íŒŒë¼ë¯¸í„°ë¥¼ ë°›ìŠµë‹ˆë‹¤. scopeì€ Jotaiì˜ ìŠ¤ì½”í”„ë¥¼ ì§€ì •í•˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤.
): Awaited<Value> { // í•¨ìˆ˜ëŠ” Promiseê°€ í•´ê²°ëœ ê°’(Value)ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

  // getScopeContext í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ìŠ¤ì½”í”„ì˜ Contextë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
  const ScopeContext = getScopeContext(scope)

  // í˜„ì¬ ìŠ¤ì½”í”„ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
  const scopeContainer = useContext(ScopeContext)

  // ìŠ¤ì½”í”„ ì»¨í…Œì´ë„ˆì—ì„œ ìŠ¤í† ì–´ì™€ ë²„ì „ ì •ë³´ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
  const { s: store, v: versionFromProvider } = scopeContainer

  // atomì˜ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
  const getAtomValue = (version?: VersionObject) => {
    // Jotai ìŠ¤í† ì–´ì˜ READ_ATOM ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ atomì˜ ìƒíƒœë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const atomState = store[READ_ATOM](atom, version)

    // atomì˜ ìƒíƒœê°€ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
    if (__DEV__ && !atomState.y) {
      throw new Error('should not be invalidated')
    }

    // atomì˜ ì½ê¸° ë„ì¤‘ ë°œìƒí•œ ì˜¤ë¥˜ê°€ ìˆëŠ” ê²½ìš° í•´ë‹¹ ì˜¤ë¥˜ë¥¼ throw í•©ë‹ˆë‹¤.
    if ('e' in atomState) {
      throw atomState.e // read error
    }

    // atomì˜ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì— ë¹„ë™ê¸° ì‘ì—…(promise)ì´ ìˆëŠ” ê²½ìš° í•´ë‹¹ promiseë¥¼ throw í•©ë‹ˆë‹¤.
    if ('p' in atomState) {
      throw atomState.p // read promise
    }

    // atomì˜ ê°’ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° í•´ë‹¹ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    if ('v' in atomState) {
      return atomState.v as Awaited<Value>
    }

    // atomì˜ ê°’ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
    throw new Error('no atom value')
  }

  // useReducer í›…ì„ ì‚¬ìš©í•˜ì—¬ ìƒíƒœ ê°’ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
  const [[version, valueFromReducer, atomFromReducer], rerenderIfChanged] =
    useReducer<
      Reducer<
        readonly [VersionObject | undefined, Awaited<Value>, Atom<Value>],
        VersionObject | undefined
      >,
      VersionObject | undefined
    >(
      // ë¦¬ë“€ì„œ í•¨ìˆ˜ì…ë‹ˆë‹¤.
      (prev, nextVersion) => {
        // atomì˜ ìƒˆë¡œìš´ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const nextValue = getAtomValue(nextVersion)
        // ì´ì „ ê°’ê³¼ ìƒˆë¡œìš´ ê°’ì´ ë™ì¼í•˜ê³ , atomì´ ë™ì¼í•œ ê²½ìš° ì´ì „ ìƒíƒœë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        if (Object.is(prev[1], nextValue) && prev[2] === atom) {
          return prev // bail out
        }
        // ìƒˆë¡œìš´ ë²„ì „ê³¼ ê°’, atomì„ ë°˜í™˜í•©ë‹ˆë‹¤.
        return [nextVersion, nextValue, atom]
      },
      versionFromProvider,
      // ì´ˆê¸° ë²„ì „ì„ ì„¤ì •í•˜ê³  atomì˜ ì´ˆê¸° ê°’ë„ ê°€ì ¸ì˜µë‹ˆë‹¤.
      (initialVersion) => {
        const initialValue = getAtomValue(initialVersion)
        return [initialVersion, initialValue, atom]
      }
    )

  // í˜„ì¬ ê°’ì´ reducerì—ì„œ ê°€ì ¸ì˜¨ ê°’ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
  let value = valueFromReducer

  // atomì´ reducerì—ì„œ ê°€ì ¸ì˜¨ atomê³¼ ë‹¤ë¥¸ ê²½ìš°, ë¦¬ë Œë”ë§ì„ ì¼ìœ¼í‚µë‹ˆë‹¤.
  if (atomFromReducer !== atom) {
    rerenderIfChanged(version)
    // atomì˜ ìƒˆë¡œìš´ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
    value = getAtomValue(version)
  }

  // ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ë  ë•Œ ì‹¤í–‰ë˜ëŠ” íš¨ê³¼ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  useEffect(() => {
    // ìŠ¤ì½”í”„ ì»¨í…Œì´ë„ˆì—ì„œ ë²„ì „ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const { v: versionFromProvider } = scopeContainer
    // ë²„ì „ ì •ë³´ê°€ ìˆëŠ” ê²½ìš° ìŠ¤í† ì–´ì— atomì„ ì»¤ë°‹í•©ë‹ˆë‹¤.
    if (versionFromProvider) {
      store[COMMIT_ATOM](atom, versionFromProvider)
    }
    // atomì´ ì¬êµ¬ë…ë˜ë©´ì„œ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚˜ë„ë¡ í•©ë‹ˆë‹¤.
    const unsubscribe = store[SUBSCRIBE_ATOM](
      atom,
      rerenderIfChanged,
      versionFromProvider
    )
    // ì´ˆê¸° ë²„ì „ìœ¼ë¡œ ë¦¬ë Œë”ë§ì„ ì¼ìœ¼í‚µë‹ˆë‹¤.
    rerenderIfChanged(versionFromProvider)
    // ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” cleanup í•¨ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    return unsubscribe
  }, [store, atom, scopeContainer])

  // atomì˜ ê°’ì— ëŒ€í•œ ë””ë²„ê·¸ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
  useDebugValue(value)

  // atomì˜ ê°’ì´ ë°˜í™˜ë©ë‹ˆë‹¤.
  return value
}


```

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ useReducer

**âœ… useReducerì—ì„œ ë°˜í™˜í•˜ëŠ” ìƒíƒœê°’ 3ê°€ì§€**

- version storeì˜ ë²„ì „
- valueFromReducer atomì—ì„œ get ìˆ˜í–‰í–ˆì„ ë•Œ ë°˜í™˜í•˜ëŠ” ê°’
- atomFromReducer atom ê°’ ê·¸ ìì²´

**âœ… ì´ atomì˜ ê°’ì€ storeì— ì¡´ì¬**

- weakMap : storeì— atom ê°ì²´ ê·¸ ìì²´ë¥¼ í‚¤ë¡œ í™œìš©í•´ ê°’ì„ ì €ì¥ â‡’ jsì—ì„œ ê°ì²´ë§Œì„ í‚¤ë¡œ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ë…íŠ¹í•œ ë°©ì‹ì˜ Mapì„ í™œìš©í•´ recoilê³¼ëŠ” ë‹¤ë¥´ê²Œ ë³„ë„ì˜ keyë¥¼ ë°›ì§€ ì•Šì•„ë„ ìŠ¤í† ì–´ì— ê°’ì„ ì €ì¥ í•  ìˆ˜ ìˆë‹¤.

**âœ… ë¦¬ë Œë”ë§ì„ ì¼ìœ¼í‚¤ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” rerederIfChanged, ì–¸ì œ ë°œìƒí•˜ëŠ”ê°€!**

- ë„˜ê²¨ ë°›ì€ atomì´ reducerë¥¼ í†µí•´ ìŠ¤í† ì–´ì— ìˆëŠ” atomê³¼ ë‹¬ë¼ì§€ëŠ” ê²½ìš°
- subscribeë¥¼ ìˆ˜í–‰í•˜ê³  ìˆë‹¤ê°€ ì–´ë””ì„ ê°€ ì´ ê°’ì´ ë‹¬ë¼ì§€ëŠ” ê²½ìš°

**[êµ¬í˜„ ì›ë¦¬]**

1.  **ë‚´ë¶€ ìŠ¤í† ì–´ ì ‘ê·¼**: useAtomValueëŠ” ë‚´ë¶€ì ìœ¼ë¡œ Jotai ìŠ¤í† ì–´ì— ì ‘ê·¼í•˜ì—¬ atomì˜ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
2.  **ë¦¬ë“€ì„œë¥¼ í†µí•œ ìƒíƒœ ê´€ë¦¬**: useReducerë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ë¦¬ë“€ì„œëŠ” í˜„ì¬ atom ê°’ê³¼ ë²„ì „ ì •ë³´ë¥¼ ì €ì¥í•˜ê³ , atom ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ë²„ì „ ì •ë³´ì™€ í•¨ê»˜ ìƒíƒœë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.
3.  **ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œ ë¦¬ë Œë”ë§**: atom ê°’ì´ ë³€ê²½ë˜ë©´ ë¦¬ë“€ì„œë¥¼ í†µí•´ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ê³ , ì´ë¡œ ì¸í•´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë©ë‹ˆë‹¤.
4.  **ìŠ¤í† ì–´ ë³€ê²½ ê°ì§€ì™€ êµ¬ë…**: useEffect í›…ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤í† ì–´ì˜ ë³€ê²½ì„ ê°ì§€í•˜ê³ , atom ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë¦¬ë Œë”ë§ì„ ì¼ìœ¼í‚µë‹ˆë‹¤.
5.  **ê°’ ë°˜í™˜**: ìµœì‹  ë²„ì „ì˜ atom ê°’ì´ ë°˜í™˜ë©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¡œì§ ë•ì— atomì˜ ê°’ì´ ì–´ë””ì„œ ë³€ê²½ë˜ë”ë¼ë„ useAtomValueë¡œ ê°’ì„ ì‚¬ìš©í•˜ëŠ” ìª½ì—ì„œëŠ” ì–¸ì œë“  ìµœì‹  ê°’ì˜ atomì„ ì‚¬ìš©í•´ ë Œë”ë§í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

## 3) useAtom

useStateì™€ ë™ì¼í•œ í˜•íƒœì˜ ë°°ì—´ì„ ë°˜í™˜

- atomì˜ í˜„ì¬ ê°’ì„ ë‚˜íƒ€ë‚´ëŠ” useAtomValue í›…ì˜ ê²°ê³¼ë¥¼ ë°˜í™˜
- useSetAtom(atom ìˆ˜ì •ê°€ëŠ¥í•œ í›…) í›…ì„ ë°˜í™˜

```jsx
export function useSetAtom<Value, Update, Result extends void | Promise<void>>(
  atom: WritableAtom<Value, Update, Result>,
  scope?: Scope
): SetAtom<Update, Result> {
  const ScopeContext = getScopeContext(scope)
  const { s: store, w: versionedWrite } = useContext(ScopeContext)
  const setAtom = useCallback(
    (update: Update) => {
      if (__DEV__ && !('write' in atom)) {
        // useAtom can pass non writable atom with wrong type assertion,
        // so we should check here.
        throw new Error('not writable atom')
      }
      const write = (version?: VersionObject) =>
        store[WRITE_ATOM](atom, update, version)
      return versionedWrite ? versionedWrite(write) : write()
    },
    [store, versionedWrite, atom]
  )
  return setAtom as SetAtom<Update, Result>
}

```

- setAtomìœ¼ë¡œ ëª…ëª…ëœ writeí•¨ìˆ˜ë¥¼ ë³´ë©´ writeí•¨ìˆ˜ëŠ” ìŠ¤í† ì–´ì—ì„œ í•´ë‹¹ atomì„ ì°¾ì•„ì„œ ì§ì ‘ ê°’ì„ ì—…ë°ì´íŠ¸í•œë‹¤.
- ìŠ¤í† ì–´ì—ì„œ ìƒˆë¡œìš´ ê°’ì„ ì‘ì„±í•œ ì´í›„ì—ëŠ” í•´ë‹¹ ê°’ì˜ ë³€í™”ì— ëŒ€í•´ ì•Œê³  ìˆì–´ì•¼ í•˜ëŠ” listener í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ ê°’ì˜ ë³€í™”ê°€ ìˆìŒì„ ì „íŒŒí•˜ê³ , ì‚¬ìš©í•˜ëŠ” ìª½ì—ì„œ ë¦¬ë Œë”ë§ì´ ìˆ˜í–‰ë˜ê²Œ í•œë‹¤.

## jotaië¥¼ ì‚¬ìš©í•´ë³´ì

```jsx
import { atom, useAtom, useAtomValue } from 'jotai';
import React from 'react';

const counterState = atom(0);

function Counter() {
  const [, setCount] = useAtom(counterState);

  function handleButtonClick() {
    setCount((count) => count + 1);
  }

  return (
    <>
      <button onClick={handleButtonClick}>+</button>
    </>
  );
}

const isBiggerThan10 = atom((get) => get(counterState) > 10);

function Count() {
  const count = useAtomValue(counterState);
  const biggerThan10 = useAtomValue(isBiggerThan10);

  return (
    <>
      <h3>{count}</h3>
      <p>count is bigger than 10 : {JSON.stringify(biggerThan10)}</p>
    </>
  );
}
const MyComponent = () => {
  return (
    <>
      <Counter></Counter>
      <Count></Count>
    </>
  );
};

export default MyComponent;
```

- ìƒíƒœ ì„ ì–¸ì„ ìœ„í•´ atomì´ë¼ëŠ” API ì‚¬ìš©
  â‡’ useStateì™€ëŠ” ë‹¤ë¥´ê²Œ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì—ì„œë„ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì 
- atomì€ ê°’ë¿ë§Œ ì•„ë‹ˆë¼ í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.
  â‡’ ì´ëŸ¬í•œ íŠ¹ì§•ìœ¼ë¡œ ë‹¤ë¥¸ atomì˜ ê°’ìœ¼ë¡œë¶€í„° íŒŒìƒëœ atomì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- useStateì™€ ë¹„ìŠ·í•˜ê²Œ ì‚¬ìš©í•˜ê±°ë‚˜ useAtomValueë¥¼ í†µí•´ getterë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
- ê¸°ë³¸ì ì¸ APIì™¸ì—ë„ localStorageì™€ ì—°ë™í•´ ì˜êµ¬ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê±°ë‚˜, Next.js, ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œì™€ ì—°ë™í•˜ëŠ” ë“± ìƒíƒœì™€ ê´€ë ¨ëœ ë‹¤ì–‘í•œ ì‘ì—…ì„ ì§€ì›í•œë‹¤.

íŠ¹ì§• :

- Recoilì€ í‚¤ë¡œ atomì„ ê´€ë¦¬í•˜ì§€ë§Œ, Jotaiì—ì„œëŠ” ì´ëŸ° ë¶€ë¶„ë“¤ì„ ì¶”ìƒí™”í•´ ì‚¬ìš©ìê°€ í‚¤ë¥¼ ê´€ë¦¬ í•  í•„ìš” ì—†ë‹¤. â‡’ ê°ì²´ì˜ ì ì¡°ë¥¼ í†µí•´ ê°’ì„ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ë³´ë‹¤ ê°„ê²°ëœ í˜•íƒœë¡œ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.
- íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‘ì„±ë¼ ìˆì–´ íƒ€ì…ì„ ì˜ ì§€ì›í•´ì¤€ë‹¤. â‡’ flowë¡œ ì‘ì„±ë˜ì–´ ë³„ë„ë¡œ d.tsë¥¼ ì œê³µí•˜ëŠ” recoil ëŒ€ë¹„ ì¥ì ì´ë‹¤.

# 3. ì‘ê³  ë¹ ë¥´ë©° í™•ì¥ì—ë„ ìœ ì—°í•œ Zustand

zustandëŠ” ëˆ„êµ¬ì˜ ì˜ê°ì„ ë°›ì•˜ë‚˜? redux

ì¦‰ atomì´ë¼ëŠ” ê°œë…ìœ¼ë¡œ ìµœì†Œ ë‹¨ìœ„ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ zustandì—ì„œëŠ” í•˜ë‚˜ì˜ ìŠ¤í† ì–´ë¥¼ ì¤‘ì•™ ì§‘ì¤‘í˜•ìœ¼ë¡œ í™œìš©í•´ ì´ ìŠ¤í† ì–´ ë‚´ë¶€ì—ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ìˆë‹¤.

**[zustandì˜ ë°”ë‹ë¼ ì½”ë“œ]** </br>
zustandì—ì„œ ìŠ¤ì½”ì–´ë¥¼ ë§Œë“œëŠ” ì½”ë“œë¥¼ ì‚´í´ë³´ì

```jsx
const createStoreImpl: CreateStoreImpl = (createState) => {
  type TState = ReturnType<typeof createState>
  type Listener = (state: TState, prevState: TState) => void

  // ì´ ë³€ìˆ˜ëŠ” createStoreImpl í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ì§€ë§Œ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì •ì˜ë˜ì§€ ì•Šì•˜ë‹¤.
  // ëŒ€ì‹  í•¨ìˆ˜ ì™¸ë¶€ì—ì„œ ì •ì˜ë˜ì–´ ìˆìœ¼ë¯€ë¡œ createStoreImpl í•¨ìˆ˜ ì™¸ë¶€ì—ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  ìˆìŒì„ ì•”ì‹œ

  let state: TState

  const listeners: Set<Listener> = new Set()

  const setState: SetStateInternal<TState> = (partial, replace) => {

// partialì´ í•¨ìˆ˜ì¸ ê²½ìš°, stateì˜ ì¼ë¶€ë¥¼ ë³€ê²½í•˜ëŠ” ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.
  const nextState =
    typeof partial === 'function'
      ? (partial as (state: TState) => TState)(state)
      : partial;

  // nextStateê°€ í˜„ì¬ stateì™€ ë‹¤ë¥¸ ê²½ìš°ì—ë§Œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.
  if (nextState !== state) {
    const previousState = state;

    // replaceê°€ ì£¼ì–´ì§„ ê²½ìš° ë˜ëŠ” nextStateê°€ ê°ì²´ê°€ ì•„ë‹Œ ê²½ìš°(stateë¥¼ ì™„ì „íˆ êµì²´í•´ì•¼ í•˜ëŠ” ê²½ìš°),
    // nextStateë¥¼ ìƒˆë¡œìš´ stateë¡œ ì„¤ì •í•œë‹¤.
    state =
      replace ?? typeof nextState !== 'object'
        ? (nextState as TState)
        : Object.assign({}, state, nextState);

    // ìƒíƒœê°€ ë³€ê²½ë˜ë©´ ë“±ë¡ëœ ëª¨ë“  ë¦¬ìŠ¤ë„ˆì—ê²Œ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ì•Œë ¤ì¤€ë‹¤.
    listeners.forEach((listener) => listener(state, previousState));
    }
  }

	// getStateëŠ” í´ë¡œì €ì˜ ìµœì‹  ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì¡Œë‹¤.
  const getState: () => TState = () => state

	// listenerë¥¼ ë“±ë¡í•˜ëŠ”ë°, listenerëŠ” ë§ˆì°¬ê°€ì§€ë¡œ set í˜•íƒœë¡œ ì„ ì–¸ë˜ì–´ ì¶”ê°€ì™€ ì‚­ì œ, ê·¸ë¦¬ê³  ì¤‘ë³µê´€ë¦¬ê°€ ìš©ì´í•˜ê²Œë” ì„¤ê³„
  // => ìƒíƒœ ê°’ì´ ë³€ê²½ë  ë•Œ ë¦¬ë Œë”ë§ì´ í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ì— ì „íŒŒë  ëª©ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§
  const subscribe: (listener: Listener) => () => void = (listener) => {
    listeners.add(listener)
    // Unsubscribe
    return () => listeners.delete(listener)
  }

// listenersë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì—­í• 
  const destroy: () => void = () => listeners.clear()

  const api = { setState, getState, subscribe, destroy }
  state = (createState as PopArgument<typeof createState>)(
    setState,
    getState,
    api
  )
  return api as any
}

```

- ìŠ¤í† ì–´ì˜ êµ¬ì¡°ê°€ stateì˜ ê°’ì„ useState ì™¸ë¶€ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
- íŠ¹ì´í•œ ë¶€ë¶„ì€ partialê³¼ replaceë¡œ ë‚˜ë‰˜ì–´ì ¸ìˆëŠ”ë° partialì€ state ì¼ë¶€ë§Œ ë³€ê²½í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©, replaceëŠ” stateë¥¼ ì™„ì „íˆ ìƒˆë¡œìš´ ê°’ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš© â‡’ ì´ë¡œì¨ stateì˜ ê°’ì´ ê°ì²´ì¼ ë•Œ í•„ìš”ì— ë”°ë¼ ë‚˜ëˆ ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

ìŠ¤í† ì–´ ì½”ë“œê°€ ìˆëŠ” íŒŒì¼ì„ ë“¤ì–´ê°€ë©´ ì¬ë°ŒëŠ” ì‚¬ì‹¤ì„ ë°œê²¬í•  ìˆ˜ ìˆë‹¤.

[./src/vanilla.ts] [https://github.com/pmndrs/zustand/blob/eea3944499883eae1cf168770ed85c05afc2aae9/src/vanilla.ts](https://github.com/pmndrs/zustand/blob/eea3944499883eae1cf168770ed85c05afc2aae9/src/vanilla.ts)

- export í•˜ëŠ” ìœ ì¼í•œ í•¨ìˆ˜ ë° ë³€ìˆ˜ëŠ” ë°”ë¡œ createStoreì´ë©°, ê·¸ ì´ ì™¸ì— ëª¨ë‘ ì´ createStoreë¥¼ ì´ìš©í•˜ëŠ” ë° í•„ìš”í•œ íƒ€ì…ë¿ì´ë‹¤.
- **`vanilla.ts`** íŒŒì¼ì€ ë‹¤ë¥¸ íŒŒì¼ì´ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ importí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. â‡’ **ì˜ì¡´ì„± ì—†ìŒ**: ì´ëŠ” ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•œ ì½”ë“œê°€ í”„ë ˆì„ì›Œí¬ë‚˜ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•˜ì§€ ì•Šê³ ë„ ì‘ë™í•  ìˆ˜ ìˆìŒì„ ë³´ì—¬ì¤€ë‹¤.

```jsx
type CounterStore = {
	counter : number
    increase : (num : number) => void
}

const store = createStore<CounterStore>((set) => ({
	count : 0,
    increase : (num : number) => set((state) => ({ count : state.count + num})),
}))

store.subscribe((state,prev) => {
	if(state.count !== prev.count){
    	console.log('count has been changed',state.count)
    }
})

store.setState((state) => ({count : state.count + 1})

store.getState().increase(10)


```

í•œê°€ì§€ ëˆˆì—¬ê²¨ ë³¼ ê²ƒ

- createStoreë¡œ ìŠ¤í† ì–´ë¥¼ ë§Œë“¤ ë•Œ setì´ë¼ëŠ” ì¸ìˆ˜ë¥¼ í™œìš©í•´ ìƒì„±í•  ìˆ˜ ìˆë‹¤. â‡’ stateë¥¼ ìƒì„±í•  ë•Œ setState, getState, apië¥¼ ì¸ìˆ˜ë¡œ ë„˜ê²¨ì¤¬ê¸° ë•Œë¬¸ì— ê°€ëŠ¥

setì„ í†µí•´ í˜„ì¬ ìŠ¤í† ì˜ ê°’ì„ ì¬ì •ì˜í•  ìˆ˜ ìˆê³  ë‘ë²ˆì§¸ ì¸ìˆ˜ë¡œ getì„ ì¶”ê°€í•´ í˜„ì¬ ìŠ¤í† ì–´ì˜ ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ë„ ìˆë‹¤.

subscribeë¥¼ í†µí•´ ìŠ¤í† ì–´ì˜ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ íŠ¹ì • í•¨ìˆ˜ë¥¼ ì‹¤í–‰ í•  ìˆ˜ë„ ìˆë‹¤.
â‡’ í˜„ì¬ ê°’ê³¼ ì´ì „ ê°’ ë‘˜ë‹¤ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ íŠ¹ì • ê°’ì´ ë³€ê²½ë  ë•Œë§Œ ì‹¤í–‰ë˜ê²Œë” ìµœì í™” í•  ìˆ˜ ìˆë‹¤.

## zustandì˜ ë¦¬ì•¡íŠ¸ ì½”ë“œ

Zustandë¥¼ ë¦¬ì•¡íŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì–´ë””ì„ ê°€ ì´ storeë¥¼ ì½ê³  ë¦¬ë Œë”ë§ì„ í•´ì•¼í•œë‹¤. ì´ í•¨ìˆ˜ë“¤ì€ /src/react.tsì—ì„œ ê´€ë¦¬ë˜ê³  ìˆë‹¤.

**[useStore]**

```jsx
export function useStore<TState, StateSlice>(
  api: WithReact<StoreApi<TState>>,
  selector: (state: TState) => StateSlice = api.getState as any,
  equalityFn?: (a: StateSlice, b: StateSlice) => boolean
) {
  const slice = useSyncExternalStoreWithSelector(
    api.subscribe,
    api.getState,
    api.getServerState || api.getState,
    selector,
    equalityFn
  )
  useDebugValue(slice)
  return slice
}

```

useSyncExternalStoreWithSelectorë¥¼ í™œìš©í•˜ì—¬ ì•ì„  useStoreì˜ subscribe,getStateë¥¼ ë„˜ê²¨ì¤€ í›„ ìŠ¤í† ì–´ì—ì„œ ì„ íƒì„ ì›í•˜ëŠ” í•¨ìˆ˜ì¸ selectorì„ ë„˜ê²¨ì£¼ê³  ëë‚˜ê²Œ ëœë‹¤.

â‡’ ê°ì²´ê°€ ì˜ˆìƒë˜ëŠ” ì™¸ë¶€ ìƒíƒœê°’ì—ì„œ ì™¸ë¶€ ê°’ì„ êº¼ë‚´ì˜¬ ìˆ˜ ìˆë„ë¡ useSyncExternalStoreWithSelectorë¥¼ ì‚¬ìš©í–ˆë‹¤.

ì—¬ê¸°ì„œ useSyncExternalStoreëŠ” ë¦¬ì•¡íŠ¸ 18ì—ì„œ ìƒˆë¡œ ë§Œë“¤ì–´ì§„ í›…ìœ¼ë¡œ ë¦¬ì•¡íŠ¸ ì™¸ë¶€ì—ì„œ ê´€ë¦¬ë˜ëŠ” ìƒíƒœê°’ì„ ë¦¬ì•¡íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤.

**[create]**

ë¦¬ì•¡íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìŠ¤í† ì–´ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ë³€ìˆ˜ì´ë‹¤. ë°”ë‹ë¼ì˜ createStoreë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ ì¡Œê¸° ë•Œë¬¸ì— ê±°ì˜ ìœ ì‚¬í•˜ë©° useStoreë¥¼ í™œìš©í•˜ì—¬ í•´ë‹¹ ìŠ¤í† ì–´ê°€ ì¦‰ì‹œ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ ì¡Œë‹¤ëŠ” íŠ¹ì§•ì´ ìˆë‹¤.

```tsx
const createImpl = <T,>(createState: StateCreator<T, [], []>) => {
  const api = typeof createState === 'function' ? createStore(createState) : createState;

  const useBoundStore: any = (selector?: any, equalityFn?: any) => useStore(api, selector, equalityFn);

  Object.assign(useBoundStore, api);

  return useBoundStore;
};

const create = (<T,>(createState: StateCreator<T, [], []> | undefined) =>
  createState ? createImpl(createState) : createImpl) as Create;

export default create;
```

ì´ëŸ¬í•œ êµ¬ì¡° ë•ë¶„ì— ë¦¬ì•¡íŠ¸ í™˜ê²½ì—ì„œë„ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•˜ê³  ì‚¬ìš©í•˜ê¸°ê°€ ë§¤ìš° ì‰½ë‹¤.

## zustandë¥¼ ì‚¬ìš©í•´ë³´ì

```jsx
import React from 'react';
import { create } from 'zustand';

interface CounterState {
  count: number;
  inc: () => void;
  dec: () => void;
}
const useCounterStore =
  create <
  CounterState >
  ((set) => ({
    count: 1,
    inc: () => set((state) => ({ count: state.count + 1 })),
    dec: () => set((state) => ({ count: state.count - 1 })),
  }));

function Counter() {
  const { count, inc, dec } = useCounterStore();
  return (
    <div className='counter'>
      <span>{count}</span>
      <button onClick={inc}>up</button>
      <button onClick={dec}>down</button>
    </div>
  );
}

const MyComponent = () => {
  return <Counter />;
};

export default MyComponent;
```

- createë¥¼ ì‚¬ìš©í•´ ìŠ¤í† ì–´ë¥¼ ë§Œë“¤ê³ , ë°˜í™˜ ê°’ìœ¼ë¡œ ì´ ìŠ¤í† ì–´ë¥¼ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í›…ì„ ë°›ëŠ”ë‹¤.
- ì´ í›…ì„ ì‚¬ìš©ì‹œ ìŠ¤í† ì–´ ë‚´ë¶€ì— ìˆëŠ” getterì™€ setter ëª¨ë‘ì— ì ‘ê·¼í•´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ì•„ë˜ì˜ ì½”ë“œë¥¼ ë³´ë©´ createStoreì„ í†µí•˜ë©´ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì— storeë¥¼ ë§Œë“œëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

```jsx
import React from "react";
import { createStore, useStore } from "zustand";

interface CounterState {
  count: number;
  inc: () => void;
  dec: () => void;
}
const counterStore = createStore<CounterState>((set) => ({
  count: 1,
  inc: () => set((state) => ({ count: state.count + 1 })),
  dec: () => set((state) => ({ count: state.count - 1 })),
}));

function Counter() {
  const { count, inc, dec } = useStore(counterStore);
  return (
    <div className="counter">
      <span>{count}</span>
      <button onClick={inc}>up</button>
      <button onClick={dec}>down</button>
    </div>
  );
}

const MyComponent = () => {
  return <Counter />;

export default MyComponent;

```

ì´ëŸ¬ë©´ ë¦¬ì•¡íŠ¸ì™€ ìƒê´€ì—†ëŠ” ë°”ë‹ë¼ ìŠ¤í† ì–´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆê²Œ ëœë‹¤.

1.  **useCounterStore vs. useStore(counterStore):**
    - ì²« ë²ˆì§¸ ì˜ˆì œì—ì„œëŠ” **`create`** í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•˜ê³ , ë°˜í™˜ëœ í›…ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤í† ì–´ì— ì ‘ê·¼í•©ë‹ˆë‹¤. ì´ê²ƒì€ ì¼ë°˜ì ì¸ ë°©ë²•ì´ë©°, ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ í•´ë‹¹ ìŠ¤í† ì–´ì— ì ‘ê·¼ ë° ì¡°ì‘í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
    - ë‘ ë²ˆì§¸ ì˜ˆì œì—ì„œëŠ” **`createStore`** í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•˜ê³ , **`useStore`** í›…ì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ìŠ¤í† ì–´ì— ì ‘ê·¼í•©ë‹ˆë‹¤. ì´ê²ƒì€ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì—ì„œ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•˜ê³ , ì»´í¬ë„ŒíŠ¸ì—ì„œ í•´ë‹¹ ìŠ¤í† ì–´ì— ì ‘ê·¼í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë¦¬ì•¡íŠ¸ì™€ ë¬´ê´€í•œ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2.  **useCounterStore vs. counterStore:**
    - ì²« ë²ˆì§¸ ì˜ˆì œì—ì„œëŠ” **`useCounterStore`** í›…ì„ í†µí•´ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ê²ƒì€ ìŠ¤í† ì–´ì— ëŒ€í•œ getterì™€ setterë¥¼ ë°˜í™˜í•˜ë©°, ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ ìŠ¤í† ì–´ì˜ ìƒíƒœ ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ë‘ ë²ˆì§¸ ì˜ˆì œì—ì„œëŠ” **`useStore`** í•¨ìˆ˜ë¥¼ í†µí•´ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ê²ƒì€ ì™¸ë¶€ì—ì„œ ìƒì„±ëœ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ìŠ¤í† ì–´ì— ëŒ€í•œ getterì™€ setterë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ë¦¬ì•¡íŠ¸ì™€ ìƒê´€ì—†ëŠ” ë°”ë‹ë¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ í™˜ê²½ì—ì„œë„ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ì°¨ì´ì ì„ ì´í•´í•˜ë©´, Zustandë¥¼ ì‚¬ìš©í•˜ëŠ” ë‘ ê°€ì§€ ë‹¤ë¥¸ ë°©ë²•ì„ ì ì ˆíˆ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ì˜ˆì œëŠ” ì£¼ë¡œ ë¦¬ì•¡íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì—ì„œ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•  ë•Œ, ë‘ ë²ˆì§¸ ì˜ˆì œëŠ” ë¦¬ì•¡íŠ¸ì™€ ìƒê´€ì—†ëŠ” í™˜ê²½ì—ì„œ ìŠ¤í† ì–´ë¥¼ ì‚¬ìš©í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

Zustand íŠ¹ì§• :

- ZustandëŠ” ë°©ê¸ˆ ë³¸ ì˜ˆì œì²˜ëŸ¼ íŠ¹ë³„íˆ ë§ì€ ì½”ë“œ ì‘ì„± ì—†ì´ ìŠ¤í† ì–´ë¥¼ ë§Œë“¤ê³  ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ë§¤ìš° í° ì¥ì ì´ ìˆë‹¤. ì´ëŠ” ë¦¬ë•ìŠ¤ì™€ ë¹„êµí–ˆì„ë•Œ êµ‰ì¥íˆ ì¢‹ì€ ì¥ì ì´ë‹¤.
- ë˜í•œ Zustand ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í¬ê¸° ìì²´ë„ ë§¤ìš° ì‘ë‹¤.
- ì´ë ‡ê²Œ APIê°€ ë³µì¡í•˜ì§€ ì•Šê³  ê°„ë‹¨í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.
- ë¦¬ë•ìŠ¤ì²˜ëŸ¼ ë¯¸ë“¤ì›¨ì–´ë˜í•œ ì§€ì›í•˜ë©° ìŠ¤í† ì–´ ë°ì´í„°ë¥¼ ì˜êµ¬ë³´ì¡´í•´ì£¼ëŠ” persist, ë³µì¡í•œ ê°ì²´ë¥¼ ê´€ë¦¬í•˜ê¸° ì‰½ê²Œ í•´ì£¼ëŠ” immer , ë¦¬ë•ìŠ¤ì™€ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¦¬ë•ìŠ¤ ë¯¸ë“¤ì›¨ì–´ ë“±ë“± ì—¬ëŸ¬ê°€ì§€ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì œê³µí•´ì¤€ë‹¤.
