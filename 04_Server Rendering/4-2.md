# 4-2 서버 사이드 렌더링을 위한 리액트 API

### SSR(server side rendering)

1. 서버에서 사용자에게 보여줄 최초의 페이지(index.html)을 렌더링
2. 클라이언트는 html을 다운로드하여 화면에 띄움
3. hydrate하여 앱을 살아있는 상태로 만듬( 자바스크립트 핸들러나 이벤트를 붙임)

SSR이라고 서버에서만 렌더링하는 것이 아니라 처음에만 렌더링 된 index.html을 보내는 것이며, 이후에는 CSR 방식과 똑같이 Client-Side에서 렌더링을 수행합니다. 즉, SSR -> CSR 순서로 동작한다고 볼 수 있습니다. 이러한 점 때문에 **유니버설 렌더링, 현대의 SSR(Hybrid Rendering)** 이라고도 부른다.

### renderToString

```powershell
const html = renderToString(reactNode, options?)
```

- 서버에서 `renderToString`을 호출하여 앱을 HTML로 렌더링 할 수 있다.
- 인수로 넘겨받은 리액트 컴포넌트를 렌더링해 HTML 문자열로 반환하는 함수
- 최초의 페이지를 HTML로 먼저 렌더링한다고 언급했는데 (1번), 그 역할은 하는 함수
- 클라이언트에서 실행되는 자바스크립트 코드를 포함시키거나 렌더링하는 역할까지 해주지는 않는다. → 클라이언트에서 `hydrateRoot`호출 필요
- `data-reactroot` 속성 포함 : 리액트 컴포넌트의 루트 엘리먼트가 무엇인지 식별하는 속성
- Parameters
    - `reactNode`: HTML로 렌더링하려는 React 노드. 예를 들어, `<App />`과 같은 JSX 노드.
    - 선택 사항 `options` : 서버 렌더링 옵션 제어를 위한 개체.
- Returns
    - HTML 문자열
    

```powershell
const result = ReactDOMServer.renderToString(
	React.createElement('div', {id: 'root'}, <SampleComponent />),
	)
```

### renderToStaticMarkup

```powershell
const html = renderToStaticMarkup(reactNode, options?)
```

- `renderToStaticMarkup`non-interactive React 트리를 HTML 문자열로 렌더링
- `renderToString`과 매우 유사한 함수
- **루트 요소에 추가한 data-reactroot와 같은 리액트에서만 사용하는 추가적인 DOM 속성을 만들지 않는다.** → 순수 HTML 문자열이 반환된다.
- 리액트에서만 사용하는 속성을 제거하면 결과물인 HTML의 크기를 약간이라도 줄일 수 있다는 장점이 있다.
- `hydrate`를 수행하지 않는다.
- Parameters
    - `reactNode`: HTML로 렌더링하려는 React 노드. 예를 들어, `<Page />`와 같은 JSX 노드.
    - 선택 사항 `options` : 서버 렌더링 옵션 제어를 위한 개체.
- Returns
    - HTML 문자열

### renderToNodeStream

```powershell
const stream = renderToNodeStream(reactNode, options?)
```

- `renderToString`과 결과물이 완전히 동일
- `renderToNodeStream`은 브라우저에서 사용하는 것이 완전히 불가능하다. Node.js 환경에 의존한다.
- `renderToNodeStream`의 결과물 타입은 Node.js의 utf-8로 인코딩된 바이트 스티림인 `ReadableStream`이다.
- 브라우저가 원하는 결과물, 즉, string을 얻기 위해서는 추가적인 처리가 필요하다.
- `renderToString`으로 생성해야 하는 HTML의 크기가 매우 클 때 서버가 부담을 느끼는 경우, 스트림을 활용하여 큰 데이터를 청크 단위로 분리해 순차적으로 처리할 수 있다.
- 서버의 부담을 덜기 위해 사용
- Parameters
    - `reactNode`: HTML로 렌더링하려는 React 노드. 예를 들어, `<Page />`와 같은 JSX 노드.
    - 선택 사항 `options` : 서버 렌더링 옵션 제어를 위한 개체.
- Return
    - HTML 문자열을 출력하는 `ReadableStream`
    
- → React 18에서는 `[renderToPipeableStream`](https://react.dev/reference/react-dom/server/renderToPipeableStream)

### renderToStaticNodeStream

```powershell
const stream = renderToStaticNodeStream(reactNode, options?)
```

- `renderToNodeStream`과 제공하는 결과물은 동일
- `renderToStaticMarkup`과 마찬가지로 리액트 속성이 제공되지 않는다.
- 마찬가지로 `hydrate`를 할 필요가 없는 순수 HTML 결과물이 필요할 때 사용되는 메서드이다.
- Parameters
    - `reactNode`: HTML로 렌더링하려는 React 노드. 예를 들어, `<Page />`와 같은 JSX 노드.
    - 선택 사항 `options` : 서버 렌더링 옵션 제어를 위한 개체.
- Return
    - HTML 문자열을 출력하는 `ReadableStream`

### hydrate

```powershell
hydrate(reactNode, domNode, callback?)
```

- 정적으로 생성된 HTML에 이벤트와 핸들러를 붙여 완전한 웹페이지 결과물을 만든다.
- hydrate와 비슷한 브라우저에서만 사용되는 메서드는 render이다.
- render: HTML요소에 컴포넌트를 렌더링하고 이벤트 핸들러를 부티는 작업까지 한 번에 수행
- hydrate: 기본적으로 이미 렌더링된 HTML 기준으로 이벤트를 붙이는 작업만 실행
- hydrate에 넘겨준 두번째 인수에는 이미 renderToString 등으로 렌더링된 정적인 HTML 정보가 반드시 담겨 있어야 한다. 아무것도 없는 빈 HTML에 이 정보를 렌더링하는 render와의 차이점이다.
- 매개변수
    - `reactNode`: 기존 HTML을 렌더링하는 데 사용되는 “React 노드”, 이는 일반적으로 `<App />`로 렌더링된 JSX의 일부
    - `domNode`: 서버의 루트 요소로 렌더링된 DOM 요소
    - **선택사항** : `callback`: 함수. 통과하면 React는 구성 요소가 수화된 후에 이를 호출한다.
    
- → React 18 `hydrate`에서는 `[hydrateRoot`](https://react.dev/reference/react-dom/client/hydrateRoot)